<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Complaint Status</title>

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Inter", "Segoe UI", Arial, sans-serif;
        }

        body {
            background: #020617;
            color: #e5e7eb;
            padding: 30px;
        }

        h2 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 26px;
            font-weight: 600;
        }

        /* WRAPPER */
        .table-wrapper {
            background: #020617;
            border: 1px solid #1e293b;
            border-radius: 12px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1400px;
        }

        thead {
            background: #020617;
            border-bottom: 2px solid #334155;
        }

        th {
            padding: 14px;
            font-size: 14px;
            color: #93c5fd;
            text-align: center;
            border-right: 1px solid #1e293b;
            white-space: nowrap;
        }

        td {
            padding: 14px;
            font-size: 14px;
            text-align: center;
            vertical-align: top;
            border-right: 1px solid #1e293b;
        }

        /* Alternate rows */
        tbody tr:nth-child(even) {
            background: #020617;
        }

        tbody tr:nth-child(odd) {
            background: #0b1220;
        }

        tbody tr:hover {
            background: #0f172a;
        }

        /* Description */
        td:nth-child(4) {
            text-align: left;
            line-height: 1.6;
        }

        /* IMAGE */
        img {
            border-radius: 6px;
            border: 1px solid #334155;
        }

        iframe {
            border-radius: 6px;
            border: 1px solid #334155;
        }

        /* LINKS */
        a {
            color: #60a5fa;
            text-decoration: none;
            font-weight: 500;
        }

        a:hover {
            text-decoration: underline;
        }

        /* STATUS BADGES */
        .status {
            padding: 6px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .Pending { background: #7c2d12; color: #fed7aa; }
        .InProgress { background: #1e3a8a; color: #bfdbfe; }
        .Resolved { background: #14532d; color: #bbf7d0; }
        .Extended { background: #7c2d12; color: #fde68a; }

        /* DEADLINE */
        .deadline {
            color: #fb7185;
            font-weight: 600;
        }

        /* FORMS */
        select, input[type="date"] {
            width: 100%;
            padding: 6px;
            border-radius: 6px;
            background: #020617;
            border: 1px solid #334155;
            color: #e5e7eb;
            margin-bottom: 6px;
            font-size: 13px;
        }

        button, input[type="submit"] {
            width: 100%;
            padding: 7px;
            border-radius: 6px;
            background: #2563eb;
            color: white;
            font-weight: 600;
            border: none;
            cursor: pointer;
        }

        button:hover, input[type="submit"]:hover {
            background: #1d4ed8;
        }

        /* ACTION CELL */
        td:last-child {
            background: #020617;
        }
    </style>
</head>

<body>

<h2>Update Complaint Status</h2>

<div class="table-wrapper">
<table>
    <thead>
        <tr>
            <th>User</th>
            <th>Department</th>
            <th>Category</th>
            <th>Description</th>
            <th>Priority</th>
            <th>Image</th>
            <th>Location</th>
            <th>Map</th>
            <th>Deadline</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </thead>

    <tbody>
    {% for i in val %}
    <tr>
        <td>{{ i.UserId.Name }}</td>
        <td>{{ i.DepartmentId.DepartmentName }}</td>
        <td>{{ i.Category }}</td>
        <td>{{ i.Description }}</td>
        <td>{{ i.Priority }}</td>

        <td>
            {% if i.Image %}
                <img src="{{ i.Image.url }}" width="100" height="80">
            {% else %} No Image {% endif %}
        </td>

        <td>
            {{ i.Latitude }}, {{ i.Longitude }} <br>
            <a href="https://www.google.com/maps?q={{ i.Latitude }},{{ i.Longitude }}" target="_blank">Open</a>
        </td>

        <td>
            <iframe width="230" height="160"
                src="https://www.google.com/maps?q={{ i.Latitude }},{{ i.Longitude }}&output=embed">
            </iframe>
        </td>

{% if not i.EndingDate and i.Status == 'Assigned' %}
        <td>
            <form method="post" action="{% url 'request_ending_date' %}">
                {% csrf_token %}
                <input type="hidden" name="complaint_id" value="{{ i.id }}">
                <input type="date" name="date" required>
                <input type="submit" value="Request">
            </form>
        </td>
{% else %}
        <td>
            <div class="deadline">{{ i.EndingDate }}</div>
            {% if i.Status == 'Extended' %}
                <a href="/updatedeadline/{{i.id}}">Update</a>
            {% endif %}
        </td>
{% endif %}

        <td>
            <span class="status {{ i.Status|cut:' ' }}">
                {{ i.Status }}
            </span>
        </td>

        <td>
            <form method="post" action="/UpdateStatus/{{ i.id }}">
                {% csrf_token %}
                <select name="status">
                    <option value="Pending" {% if i.Status == "Pending" %}selected{% endif %}>Pending</option>
                    <option value="In Progress" {% if i.Status == "In Progress" %}selected{% endif %}>In Progress</option>
                    <option value="Resolved" {% if i.Status == "Resolved" %}selected{% endif %}>Resolved</option>
                    <option value="Extended" {% if i.Status == "Extended" %}selected{% endif %}>Extended</option>
                </select>
                <input type="hidden" name="complaint_id" value="{{ i.id }}">
                <button type="submit">Update</button>
            </form>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
</div>

</body>
</html>
